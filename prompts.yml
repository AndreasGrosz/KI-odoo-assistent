# KI-Kontaktassistent Prompt-Vorlagen
# Erweiterte Version mit verbesserter Firmen-Erkennung

# Standard E-Mail-Extraktion (ERWEITERT fÃ¼r Firmen)
email_extraction:
  system: "Du bist ein Experte fÃ¼r Kontaktdaten-Extraktion. Antworte immer nur mit validem JSON. Achte BESONDERS auf Firmen-Erkennung und Footer-Bereiche mit strukturierten Adressen."

  user_template: |
    Du bist ein Experte fÃ¼r die Extraktion von Kontaktdaten aus E-Mails. Analysiere sorgfÃ¤ltig und extrahiere NUR verfÃ¼gbare Informationen.

    ABSENDER-EMAIL: {sender_email}
    BIOGRAPHIE (vom Benutzer hinzugefÃ¼gt): {biography}

    E-MAIL-INHALT:
    {email_text}

    KRITISCHE EXTRAKTIONSREGELN (PRIORITÃ„T 1 - FIRMEN):

    1. FIRMEN-ERKENNUNG (HÃ–CHSTE PRIORITÃ„T):
       - Erkenne Firmen-Indikatoren: GmbH, AG, Ltd, Inc, Corp, LLC, Verein, Verlag, Stiftung, KG, OHG, eG, SE
       - WENN Firma erkannt â†’ setze "is_company": true
       - Bei Firmen: "company" UND "full_name" bekommen BEIDE den Firmennamen
       - Bei Firmen: "first_name" und "last_name" bleiben leer!

    2. FIRMEN-NAME-ZUORDNUNG:
       - Beispiel: "Jungeuropa Verlag GmbH"
         â†’ "full_name": "Jungeuropa Verlag GmbH"
         â†’ "company": "Jungeuropa Verlag GmbH"
         â†’ "is_company": true
         â†’ "first_name": ""
         â†’ "last_name": ""

    3. PERSONEN BEI FIRMEN:
       - Beispiel: "Philip Stein von Jungeuropa Verlag"
         â†’ "full_name": "Philip Stein"
         â†’ "first_name": "Philip"
         â†’ "last_name": "Stein"
         â†’ "company": "Jungeuropa Verlag"
         â†’ "is_company": false

    WEITERE EXTRAKTIONSREGELN:

    4. FOOTER-PRIORITÃ„T: Achte besonders auf den FOOTER-Bereich am Ende der E-Mail!
    5. STRUKTURIERTE ADRESSEN: Erkenne Formate wie "Firma Â· StraÃŸe Nr Â· Stadt PLZ Â· Land"
    6. NAMEN: Suche nach vollstÃ¤ndigen Namen in der Signatur (Regards, Best regards, etc.)
    7. Telefonnummern: Alle Formate (+49, 0049, national, international)
    8. Adressen: VollstÃ¤ndige Postanschriften bevorzugt, auch aus Footer-Bereichen
    9. Sprache: Erkenne aus dem E-Mail-Text (deutsch/english/russisch)
    10. Kategorien: Erkenne ALLE Hashtags (#Kunde, #English, #Scientology, #Lieferant, etc.)
    11. E-MAILS: NUR die Absender-E-Mail verwenden: {sender_email} - KEINE anderen E-Mails erfinden!

    WICHTIGE HINWEISE:
    - Nutze die BIOGRAPHIE des Benutzers als zusÃ¤tzliche Information
    - Hashtags (#) sind IMMER Kategorien - extrahiere sie alle!
    - BIOGRAPHIE: Verwende NUR den Text VOR den Hashtags, NICHT die Hashtags selbst!
    - Bei Namen: Suche nach Signaturen wie "Regards, [VollstÃ¤ndiger Name]"
    - Sprache: Analysiere den Haupttext der E-Mail
    - E-MAILS: Verwende NUR die bekannte Absender-E-Mail, erfinde KEINE zusÃ¤tzlichen!
    - FOOTER-PRIORITÃ„T: Kontaktdaten aus Footer haben hÃ¶here PrioritÃ¤t als Text-ErwÃ¤hnungen
    - Leere Felder mit null fÃ¼llen

    WICHTIG - VERWECHSLUNGSGEFAHR:
    Andreas/Telse GroÃŸ (Althusweg 12, CH 6315 Morgarten, +41-41-512-00-22, 5gfrei.ch) sind NICHT der Kontakt!
    Das sind die EMPFÃ„NGER der E-Mail. Extrahiere NUR Daten des ursprÃ¼nglichen ABSENDERS: {sender_email}
    Ignoriere alle Firmendaten von Andreas GroÃŸ, 5gfrei.ch, inggross.de, standortdatenblatt.ch!

    ABSENDER-FOKUS:
    - NUR Daten extrahieren die zum Absender {sender_email} gehÃ¶ren
    - NICHT die Daten der weitergeleiteten E-Mail-EmpfÃ¤nger verwenden
    - Bei Unsicherheit: Feld leer lassen statt falsche Daten zu verwenden

    FIRMEN-BEISPIELE:

    Beispiel 1 - Firma:
    Input: "Jungeuropa Verlag GmbH, Enderstr. 94, 01277 Dresden"
    Output: {{
        "first_name": "",
        "last_name": "",
        "full_name": "Jungeuropa Verlag GmbH",
        "company": "Jungeuropa Verlag GmbH",
        "is_company": true,
        "address": {{"street": "Enderstr. 94", "city": "Dresden", "zip": "01277"}}
    }}

    Beispiel 2 - Person bei Firma:
    Input: "Philip Stein, Jungeuropa Verlag"
    Output: {{
        "first_name": "Philip",
        "last_name": "Stein",
        "full_name": "Philip Stein",
        "company": "Jungeuropa Verlag",
        "is_company": false
    }}

    ANTWORTFORMAT (nur JSON, keine Kommentare):
    {{
        "first_name": "",
        "last_name": "",
        "full_name": "Jungeuropa Verlag GmbH",
        "emails": ["{sender_email}"],
        "phones": [],
        "address": {{
            "street": "Enderstr. 94",
            "street2": null,
            "city": "Dresden",
            "zip": "01277",              // â† WICHTIG: "zip" nicht "postal_code"
            "state": null,
            "country": "Germany"
        }},
        "website": null,
        "company": "Jungeuropa Verlag GmbH",
        "position": null,
        "is_company": true,
        "language": "deutsch",
        "categories": ["verlag"],
        "biography": "...",
        "confidence": "high"
    }}

# Manueller Kontakt-Input (ERWEITERT fÃ¼r Firmen)
manual_extraction:
  system: "Du bist ein Experte fÃ¼r strukturierte Kontaktdaten-Extraktion aus manuellen Eingaben. Antworte immer nur mit validem JSON. Erkenne Firmen-Pattern und Business-Karten-Ã¤hnliche Formate."

  user_template: |
    Du bist ein Experte fÃ¼r die Extraktion von Kontaktdaten aus strukturierten manuellen Eingaben wie Visitenkarten, Firmendaten oder Business-Kontakten.

    EINGABE-FORMAT: Strukturierter manueller Kontakt-Input (KEINE weitergeleitete E-Mail)
    GENERIERTE EMAIL: {sender_email}

    TEXT-INHALT:
    {email_text}

    FIRMEN-ERKENNUNG (HÃ–CHSTE PRIORITÃ„T):
    1. Erkenne: AG, GmbH, Aktiengesellschaft, Inc, Corp, Ltd, Verlag, Verein â†’ is_company: true
    2. Bei Firmen: Firmenname wird "full_name" UND "company"
    3. Bei Firmen: first_name/last_name bleiben leer

    SPEZIELLE EXTRAKTIONSREGELN fÃ¼r STRUKTURIERTE EINGABEN:
    4. BIOGRAPHIE: Alles VOR den Hashtags (#) ist die Biographie - aber OHNE Kontaktdaten!
    5. KATEGORIEN: Alle Hashtags (#kategorie) sind Kategorien
    6. FIRMEN-PATTERN: Erkenne "**Bezeichnung** Firmenname" oder "Firmenname AG/GmbH/Aktiengesellschaft"
    7. ADRESS-PATTERN: "StraÃŸenname Nummer PLZ Stadt Land" in einer Zeile
    8. TELEFON-PATTERN: "Tel. +49 (...)" oder "Telefon:" oder "+49" Nummern
    9. FAX-PATTERN: "Fax +49 (...)" - als separate Info behandeln
    10. E-MAIL-PRIORITÃ„T: Im Text gefundene E-Mail hat Vorrang vor generierter E-Mail
    11. POSITIONS-ERKENNUNG: "**Titel**", "Vorstand", "CEO", "Manager", "Vorsitzender"
    12. LAND-NORMALISIERUNG: "Deutschland" â†’ "Germany", etc.

    FIRMEN-BEISPIEL fÃ¼r MANUELLEN INPUT:
    Input: "#Kunde **Konzernzentrale** Siemens Aktiengesellschaft Werner-von-Siemens-StraÃŸe 1 80333 MÃ¼nchen Deutschland contact@siemens.com Tel. +49 (89) 3803 5491"

    Erwartete Extraktion:
    {{
        "first_name": "",
        "last_name": "",
        "full_name": "Siemens Aktiengesellschaft",
        "emails": ["contact@siemens.com"],
        "phones": ["+49 (89) 3803 5491"],
        "address": {{"street": "Werner-von-Siemens-StraÃŸe 1", "city": "MÃ¼nchen", "zip": "80333", "country": "Deutschland"}},
        "company": "Siemens Aktiengesellschaft",
        "is_company": true,
        "categories": ["kunde"],
        "biography": "",
        "confidence": "high"
    }}

    WICHTIGE HINWEISE fÃ¼r MANUELLE EINGABEN:
    - BIOGRAPHIE = Beschreibender Text VOR den Hashtags (OHNE Kontaktdaten!)
    - Kontaktdaten (Telefon, Adresse, E-Mail) gehÃ¶ren NICHT in die Biographie
    - Bei Firmen: full_name UND company bekommen beide den Firmennamen â†’ RICHTIG!
    - Bei Personen: Wenn "**Position** Name" â†’ position + full_name extrahieren
    - Hashtags (#) sind IMMER Kategorien
    - Generierte E-Mail nur verwenden wenn keine echte E-Mail gefunden
    - Deutschland/Germany/Schweiz/Switzerland normalisieren

    ANTWORTFORMAT (nur JSON, keine Kommentare):
    {{
        "first_name": "",
        "last_name": "",
        "full_name": "Siemens Aktiengesellschaft",
        "emails": ["contact@siemens.com"],
        "phones": ["+49 (89) 3803 5491"],
        "address": {{
            "street": "Werner-von-Siemens-StraÃŸe 1",
            "street2": null,
            "city": "MÃ¼nchen",
            "zip": "80333",
            "state": null,
            "country": "Deutschland"
        }},
        "website": null,
        "company": "Siemens Aktiengesellschaft",
        "position": null,
        "is_company": true,
        "language": "deutsch",
        "categories": ["kunde"],
        "biography": "",
        "confidence": "high"
    }}

# Kategorie-RÃ¼ckfrage E-Mail Template (unverÃ¤ndert)
category_inquiry:
  subject_template: "KI-RÃ¼ckfrage: Unbekannte Kategorien fÃ¼r {contact_email}"

  body_template: |
    Hallo,

    bei der Verarbeitung der E-Mail von {contact_email} konnte ich folgende Kategorien nicht zuordnen:

    âŒ Unbekannte Kategorien: {invalid_categories}

    ğŸ’¡ Meine VorschlÃ¤ge:
    {similar_suggestions}

    ğŸ” Extrahierte Kontaktdaten:
    Name: {contact_name}
    Firma: {contact_company}
    Telefon: {contact_phones}
    E-Mail: {contact_email}
    Odoo-Link: {odoo_link}

    ğŸ“‹ VERFÃœGBARE KATEGORIEN (Hilfe):
    {preferred_categories}

    AKTION:
    â€¢ Antworten Sie mit den korrekten Kategorien, oder
    â€¢ Erstellen Sie neue Kategorien in Odoo, oder
    â€¢ Ignorieren Sie diese Nachricht (Kontakt wird mit "Neuer-KI-Eintrag" angelegt)

    Format fÃ¼r Antwort:
    Biographie hier...
    #kategorie1 #kategorie2 #kategorie3

    Viele GrÃ¼ÃŸe,
    Ihr KI-Assistent

# BestÃ¤tigungs-E-Mail Templates (unverÃ¤ndert)
confirmation_created:
  subject_template: "âœ… Kontakt erstellt: {contact_email}"
  body_template: |
    Hallo,

    der Kontakt {contact_email} wurde erfolgreich erstellt.

    ğŸ¯ KONTAKTDATEN:
    â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    ğŸ‘¤ Name: {contact_name}
    ğŸ¢ Typ: {contact_type}
    ğŸ“§ E-Mail: {contact_email}
    ğŸ“ Telefon: {contact_phones}
    ğŸ  Adresse: {contact_address}
    ğŸŒ Website: {contact_website}
    ğŸ’¼ Position: {contact_position}
    ğŸ·ï¸ Kategorien: {contact_categories}

    ğŸ“ BIOGRAPHIE:
    ğŸ“ KI-Biographie wurde als Timeline-Notiz hinterlegt (im Chatter sichtbar)

    ğŸ”— Odoo-Link: {odoo_link}

    Viele GrÃ¼ÃŸe,
    Ihr KI-Assistent

confirmation_updated:
  subject_template: "âœ… Kontakt aktualisiert: {contact_email}"
  body_template: |
    Hallo,

    der Kontakt {contact_email} wurde erfolgreich aktualisiert.

    ğŸ¯ KONTAKTDATEN:
    â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    ğŸ‘¤ Name: {contact_name}
    ğŸ¢ Typ: {contact_type}
    ğŸ“§ E-Mail: {contact_email}
    ğŸ“ Telefon: {contact_phones}
    ğŸ  Adresse: {contact_address}
    ğŸŒ Website: {contact_website}
    ğŸ’¼ Position: {contact_position}
    ğŸ·ï¸ Kategorien: {contact_categories}

    ğŸ“ BIOGRAPHIE:
    ğŸ“ KI-Biographie wurde als Timeline-Notiz hinterlegt (im Chatter sichtbar)

    ğŸ”— Odoo-Link: {odoo_link}

    Viele GrÃ¼ÃŸe,
    Ihr KI-Assistent

# Erweiterte Konfiguration
extraction_config:
  max_email_length: 3000  # Smart-Strategy Ã¼bernimmt die Optimierung
  max_biography_length: 1500
  enable_footer_enhancement: true
  prioritize_footer_data: true

  # Manual Input Optimierungen
  manual_input_optimization:
    enabled: true
    recognize_business_cards: true      # Visitenkarten-Pattern
    recognize_company_formats: true     # "**Titel** Firma" Pattern
    extract_contact_details: true      # Tel/Fax/E-Mail Pattern
    normalize_countries: true          # Deutschland â†’ Germany
    clean_biography_from_contacts: true # Kontaktdaten aus Biographie entfernen

  # Firmen-Erkennung (NEU)
  company_recognition:
    enabled: true
    company_indicators: ["GmbH", "AG", "Ltd", "Inc", "Corp", "LLC", "Verein", "Verlag", "Stiftung", "KG", "OHG", "eG", "SE"]
    ensure_correct_name_assignment: true  # Firmenname â†’ name-Feld in Odoo
